<html>
  <head>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/three.js/84/three.js"></script>
  </head>
  <body>
    <script>
     let radius = <%= radius %>;
     <% ts = offset_mesh.map { |(v1, v2, v3)| "[#{v1},#{v2},#{v3}]," }  %>
     let triangles = [
         <% ts.each_slice(128) do |line| %>
             <%= line.join('') %>
         <% end %>
     ];
    </script>
    <script>
      var scene = new THREE.Scene();
      var camera = new THREE.PerspectiveCamera( 75, window.innerWidth/window.innerHeight, 0.1, 1000 );

      var renderer = new THREE.WebGLRenderer();
      renderer.setSize( window.innerWidth, window.innerHeight );
      document.body.appendChild( renderer.domElement );

      var geometry = new THREE.Geometry();
      triangles.forEach(t => {
        t.forEach(v => {
          geometry.vertices.push(new THREE.Vector3(...v))
        });

        // No normal - is that ok?
        let length = geometry.vertices.length;
        geometry.faces.push(new THREE.Face3(length - 3, length - 2, length - 1));
      });

     // Total cargo-cult setup of lighting and material
     var material = new THREE.MeshPhongMaterial( { color: 0xffffff, shading: THREE.FlatShading, overdraw: 0.5, shininess: 0 } );
     // var material = new THREE.MeshBasicMaterial( { color: 0x00ff00 } );
     var mud = new THREE.Mesh( geometry, material );
     scene.add(mud);

     scene.add( new THREE.AmbientLight( 0x444444 ) );
     directionalLight = new THREE.DirectionalLight();
     scene.add(directionalLight);

     camera.position.z = 3 * radius;

     var render = function () {
       requestAnimationFrame( render );

       mud.rotation.x += 0.001;
       mud.rotation.y += 0.001;

       renderer.render(scene, camera);
     };

     render();
    </script>
</html>
