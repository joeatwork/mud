#!/usr/bin/env ruby
# frozen_string_literal: true

require 'bundler/setup'
require 'mud'

rounds = 10
size = 50000
side = (size ** (1/3.0)).ceil
half = side / 2.0

noises = Mud::Forms::Noise.new(side, 2, 0.6)
sphere = Mud::Forms::NSphere.new(half, 2)
moved = Mud::Forms::Arrange.new(noises, [0, 0], sphere.bounds)
masked = Mud::Forms::And.new(sphere, moved)
smoothed = Mud::Filters.smooth(masked, 4, rounds)
orb = Mud::Forms::Memo.new(smoothed)

lis = [orb]
side.times.each do
  lis << Mud::Filters.smooth(Mud::Filters.converge(lis[-1]), 2, 6)
end

stack = Mud::Forms::Layers.new(lis)
nudged = Mud::Forms::Arrange.new(stack, [2, 2, 2], stack.bounds.map { |b| b + 4 })
ready = Mud::Forms::Memo.new(nudged)

renderer = Mud::Renderer::ThreeJS.new
renderer.render(ready)
